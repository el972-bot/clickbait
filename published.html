<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>×œ×•×— ×”×¤×™×ª×™×•×Ÿ â€” ×”×™×¡×˜×•×¨×™×™×ª ×¤×¨×¡×•×</title>
  <link href="https://fonts.googleapis.com/css2?family=Secular+One&family=Rubik:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #0C0C0C;
      --surface: #141414;
      --card: #1A1A1A;
      --border: #272727;
      --border-focus: #3A3A3A;
      --text: #F0EDE8;
      --text-muted: #888;
      --text-dim: #444;
      --accent: #F5A623;
      --accent-dim: rgba(245,166,35,0.12);
      --accent-border: rgba(245,166,35,0.3);
      --green: #2ECC71;
      --green-dim: rgba(46,204,113,0.12);
      --red: #E84040;
      --red-dim: rgba(232,64,64,0.12);
    }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html { scroll-behavior: smooth; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Rubik', sans-serif;
      direction: rtl;
      min-height: 100vh;
    }

    /* â”€â”€ HEADER â”€â”€ */
    header {
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      padding: 0 2rem;
      position: sticky;
      top: 0;
      z-index: 200;
    }
    .header-inner {
      max-width: 1300px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 56px;
    }
    .brand { display: flex; align-items: center; gap: 10px; }
    .brand-title {
      font-family: 'Secular One', sans-serif;
      font-weight: 400;
      font-size: 1.3rem;
      color: var(--text);
    }
    .brand-title span { color: var(--accent); }
    .page-badge {
      font-size: 0.6rem;
      font-weight: 700;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      background: var(--accent-dim);
      border: 1px solid var(--accent-border);
      color: var(--accent);
      padding: 3px 8px;
      border-radius: 2px;
    }
    .header-actions { display: flex; align-items: center; gap: 10px; }
    .btn {
      font-family: 'Rubik', sans-serif;
      font-size: 0.78rem;
      font-weight: 600;
      padding: 7px 16px;
      border-radius: 3px;
      border: none;
      cursor: pointer;
      transition: all 0.15s;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .btn-ghost {
      background: transparent;
      border: 1px solid var(--border-focus);
      color: var(--text-muted);
    }
    .btn-ghost:hover { border-color: var(--text-muted); color: var(--text); }
    .btn-danger {
      background: var(--red-dim);
      border: 1px solid rgba(232,64,64,0.2);
      color: var(--red);
    }
    .btn-danger:hover { background: rgba(232,64,64,0.22); }

    /* â”€â”€ MAIN â”€â”€ */
    main {
      max-width: 1300px;
      margin: 0 auto;
      padding: 2rem;
    }

    /* â”€â”€ TOOLBAR â”€â”€ */
    .toolbar {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }
    .toolbar-left { display: flex; align-items: center; gap: 10px; flex: 1; min-width: 0; }
    .toolbar-right { display: flex; align-items: center; gap: 10px; flex-shrink: 0; }

    .search-wrap {
      position: relative;
      flex: 1;
      max-width: 400px;
      min-width: 180px;
    }
    .search-icon {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-dim);
      font-size: 0.85rem;
      pointer-events: none;
    }
    .search-input {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 3px;
      color: var(--text);
      font-family: 'Rubik', sans-serif;
      font-size: 0.85rem;
      padding: 8px 32px 8px 12px;
      width: 100%;
      transition: border-color 0.15s;
      direction: rtl;
    }
    .search-input:focus { outline: none; border-color: var(--accent); }
    .search-input::placeholder { color: var(--text-dim); }

    .filter-select {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 3px;
      color: var(--text);
      font-family: 'Rubik', sans-serif;
      font-size: 0.8rem;
      padding: 8px 12px;
      cursor: pointer;
      transition: border-color 0.15s;
      direction: rtl;
    }
    .filter-select:focus { outline: none; border-color: var(--accent); }

    .stats-row {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .stat-chip {
      font-size: 0.65rem;
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      padding: 4px 10px;
      border-radius: 2px;
      border: 1px solid var(--border);
      color: var(--text-dim);
      white-space: nowrap;
    }
    .stat-chip .num {
      color: var(--accent);
      margin-right: 4px;
    }

    /* â”€â”€ TABLE â”€â”€ */
    .panel {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 4px;
      overflow: hidden;
    }
    .panel-header {
      padding: 0.9rem 1.25rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .panel-title {
      font-size: 0.72rem;
      font-weight: 700;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--text-muted);
    }
    .results-count {
      font-size: 0.65rem;
      color: var(--text-dim);
    }

    .history-list { display: flex; flex-direction: column; }

    .history-row {
      display: grid;
      grid-template-columns: 70px 1fr auto;
      gap: 14px;
      align-items: center;
      padding: 12px 1.25rem;
      border-bottom: 1px solid var(--border);
      transition: background 0.15s;
      animation: fadeIn 0.3s ease both;
    }
    .history-row:last-child { border-bottom: none; }
    .history-row:hover { background: var(--card); }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(6px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .h-thumb {
      width: 70px;
      height: 44px;
      object-fit: cover;
      border-radius: 2px;
      filter: saturate(0.5);
      transition: filter 0.2s;
      background: var(--card);
      flex-shrink: 0;
    }
    .h-thumb:hover { filter: saturate(1); }
    .h-thumb-placeholder {
      width: 70px;
      height: 44px;
      background: var(--card);
      border-radius: 2px;
      border: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-dim);
      font-size: 0.85rem;
      flex-shrink: 0;
    }

    .h-content { min-width: 0; }
    .h-meta {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 4px;
      flex-wrap: wrap;
    }
    .h-source {
      font-size: 0.6rem;
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--accent);
    }
    .h-cat {
      font-size: 0.58rem;
      font-weight: 600;
      padding: 2px 7px;
      border-radius: 10px;
      border: 1px solid;
    }
    .h-cat-×¤×—×“        { color: #FF3333; border-color: rgba(255,51,51,0.35); background: rgba(255,51,51,0.08); }
    .h-cat-×¡×§×¡        { color: #FF69B4; border-color: rgba(255,105,180,0.35); background: rgba(255,105,180,0.08); }
    .h-cat-×¡× ×¡×¦×™×•× ×™   { color: #FFD700; border-color: rgba(255,215,0,0.35); background: rgba(255,215,0,0.08); }
    .h-cat-×›×¢×¡           { color: #FF6B00; border-color: rgba(255,107,0,0.35); background: rgba(255,107,0,0.08); }

    .h-title {
      font-family: 'Secular One', sans-serif;
      font-size: 0.93rem;
      font-weight: 400;
      line-height: 1.35;
      color: var(--text);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .h-date {
      font-size: 0.62rem;
      color: var(--text-dim);
      margin-top: 3px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .h-stars { display: flex; gap: 1px; }
    .h-star { font-size: 0.55rem; color: var(--text-dim); }
    .h-star.lit { color: var(--accent); }
    .h-live-dot {
      width: 5px;
      height: 5px;
      border-radius: 50%;
      background: var(--green);
      display: inline-block;
      flex-shrink: 0;
    }
    .h-live-label { font-size: 0.58rem; color: var(--green); font-weight: 600; }

    .h-actions { display: flex; align-items: center; gap: 8px; flex-shrink: 0; }
    .icon-btn {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-muted);
      border-radius: 3px;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 0.8rem;
      transition: all 0.15s;
      text-decoration: none;
    }
    .icon-btn:hover { border-color: var(--accent); color: var(--accent); }
    .icon-btn.del:hover { border-color: var(--red); color: var(--red); background: var(--red-dim); }
    .icon-btn.unpublish:hover { border-color: #888; color: #ccc; }

    /* toggle live/unpublished */
    .h-unpublished { opacity: 0.45; }
    .h-unpublished .h-title { text-decoration: line-through; text-decoration-color: var(--text-dim); }

    /* â”€â”€ EMPTY â”€â”€ */
    .empty-state {
      text-align: center;
      padding: 5rem 2rem;
      color: var(--text-dim);
    }
    .empty-state .icon { font-size: 2.5rem; margin-bottom: 1rem; }
    .empty-state p { font-size: 0.85rem; line-height: 1.7; }
    .empty-state a { color: var(--accent); text-decoration: none; }

    /* â”€â”€ TOAST â”€â”€ */
    .toast {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%) translateY(20px);
      background: var(--card);
      border: 1px solid var(--border-focus);
      color: var(--text);
      padding: 10px 20px;
      border-radius: 3px;
      font-size: 0.82rem;
      font-weight: 500;
      z-index: 999;
      opacity: 0;
      transition: all 0.2s;
      white-space: nowrap;
    }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
    .toast.success { border-color: rgba(46,204,113,0.4); color: var(--green); }
    .toast.error { border-color: rgba(232,64,64,0.4); color: var(--red); }

    /* â”€â”€ DANGER ZONE â”€â”€ */
    .danger-zone {
      margin-top: 2rem;
      padding: 1rem 1.25rem;
      border: 1px solid rgba(232,64,64,0.15);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }
    .danger-label {
      font-size: 0.72rem;
      color: var(--text-dim);
    }
    .danger-label strong { color: var(--text-muted); display: block; margin-bottom: 2px; font-size: 0.75rem; }
  </style>
</head>
<body>

<header>
  <div class="header-inner">
    <div class="brand">
      <div class="brand-title">×œ×•×— ×”<span>×¤×™×ª×™×•×Ÿ</span></div>
      <div class="page-badge">×”×™×¡×˜×•×¨×™×™×ª ×¤×¨×¡×•×</div>
    </div>
    <div class="header-actions">
      <a class="btn btn-ghost" href="index.html" target="_blank">â† ×¦×¤×” ×‘××ª×¨</a>
      <a class="btn btn-ghost" href="admin.html">âš™ × ×™×”×•×œ</a>
    </div>
  </div>
</header>

<main>

  <div class="toolbar">
    <div class="toolbar-left">
      <div class="search-wrap">
        <span class="search-icon">ğŸ”</span>
        <input class="search-input" id="search-input" type="text" placeholder="×—×™×¤×•×© ×œ×¤×™ ×›×•×ª×¨×ª, ××§×•×¨..." oninput="renderHistory()" />
      </div>
      <select class="filter-select" id="cat-filter" onchange="renderHistory()">
        <option value="">×›×œ ×”×§×˜×’×•×¨×™×•×ª</option>
        <option value="×¤×—×“">ğŸ˜± ×¤×—×“</option>
        <option value="×¡×§×¡">ğŸ’‹ ×¡×§×¡</option>
        <option value="×¡× ×¡×¦×™×•× ×™">âš¡ ×¡× ×¡×¦×™×•× ×™</option>
        <option value="×›×¢×¡">ğŸ˜¡ ×›×¢×¡</option>
        <option value="__none__">×œ×œ× ×§×˜×’×•×¨×™×”</option>
      </select>
      <select class="filter-select" id="status-filter" onchange="renderHistory()">
        <option value="">×›×œ ×”×¡×˜×˜×•×¡×™×</option>
        <option value="live">×¤×¢×™×œ ×‘××ª×¨</option>
        <option value="unpublished">×”×•×¡×¨</option>
      </select>
    </div>
    <div class="toolbar-right">
      <div class="stats-row" id="stats-row"></div>
    </div>
  </div>

  <div class="panel">
    <div class="panel-header">
      <div class="panel-title">×›×œ ×”×›×•×ª×¨×•×ª ×©×¤×•×¨×¡××• ××™ ×¤×¢×</div>
      <span class="results-count" id="results-count"></span>
    </div>
    <div class="history-list" id="history-list"></div>
  </div>

  <div class="danger-zone">
    <div class="danger-label">
      <strong>××–×•×¨ ××¡×•×›×Ÿ</strong>
      ××—×™×§×ª ×”×”×™×¡×˜×•×¨×™×” ×ª×¡×™×¨ ××ª ×›×œ ×”×¨×©×•××•×ª ×œ×¦××™×ª×•×ª. ×œ× × ×™×ª×Ÿ ×œ×©×—×–×¨.
    </div>
    <button class="btn btn-danger" onclick="clearHistory()">ğŸ—‘ ××—×§ ×”×™×¡×˜×•×¨×™×”</button>
  </div>

</main>

<div class="toast" id="toast"></div>

<script>
// â”€â”€ STATE â”€â”€
let history = JSON.parse(localStorage.getItem('pb_history') || '[]');
const livePublished = () => new Set((JSON.parse(localStorage.getItem('pb_published') || '[]')).map(p => p.id));

// â”€â”€ INIT â”€â”€
renderStats();
renderHistory();

// â”€â”€ STATS â”€â”€
function renderStats() {
  const liveIds = livePublished();
  const total = history.length;
  const live = history.filter(p => liveIds.has(p.id)).length;
  document.getElementById('stats-row').innerHTML = `
    <div class="stat-chip"><span class="num">${total}</span> ×¡×”"×›</div>
    <div class="stat-chip"><span class="num" style="color:var(--green)">${live}</span> ×¤×¢×™×œ×™×</div>
    <div class="stat-chip"><span class="num">${total - live}</span> ×”×•×¡×¨×•</div>
  `;
}

// â”€â”€ RENDER â”€â”€
function renderHistory() {
  const query = document.getElementById('search-input').value.trim().toLowerCase();
  const catFilter = document.getElementById('cat-filter').value;
  const statusFilter = document.getElementById('status-filter').value;
  const liveIds = livePublished();

  let items = history.filter(p => {
    if (query && !p.title.toLowerCase().includes(query) && !(p.source||'').toLowerCase().includes(query)) return false;
    if (catFilter === '__none__' && p.category) return false;
    if (catFilter && catFilter !== '__none__' && p.category !== catFilter) return false;
    const isLive = liveIds.has(p.id);
    if (statusFilter === 'live' && !isLive) return false;
    if (statusFilter === 'unpublished' && isLive) return false;
    return true;
  });

  document.getElementById('results-count').textContent =
    items.length === history.length ? `${items.length} ×›×•×ª×¨×•×ª` : `${items.length} ××ª×•×š ${history.length}`;

  const container = document.getElementById('history-list');

  if (!items.length) {
    if (!history.length) {
      container.innerHTML = `
        <div class="empty-state">
          <div class="icon">ğŸ“­</div>
          <p>×¢×“×™×™×Ÿ ×œ× ×¤×•×¨×¡××• ×›×•×ª×¨×•×ª.<br/><a href="admin.html">×¢×‘×•×¨ ×œ× ×™×”×•×œ</a> ×›×“×™ ×œ××©×•×š ×•×œ×¤×¨×¡× ×›×•×ª×¨×•×ª.</p>
        </div>`;
    } else {
      container.innerHTML = `<div class="empty-state"><div class="icon">ğŸ”</div><p>×œ× × ××¦××• ×ª×•×¦××•×ª ×œ×—×™×¤×•×© ×–×”.</p></div>`;
    }
    return;
  }

  container.innerHTML = items.map((p, i) => {
    const isLive = liveIds.has(p.id);
    const catKey = (p.category || '').replace(/\s+/g, '-');
    const catBadge = p.category
      ? `<span class="h-cat h-cat-${catKey}">${p.category}</span>`
      : '';
    const stars = [1,2,3,4,5].map(n =>
      `<span class="h-star ${n <= (p.stars||3) ? 'lit' : ''}">â˜…</span>`
    ).join('');
    const dateStr = p.publishedAt
      ? new Date(p.publishedAt).toLocaleDateString('he-IL', { day:'numeric', month:'long', year:'numeric', hour:'2-digit', minute:'2-digit' })
      : '';
    const liveIndicator = isLive
      ? `<span class="h-live-dot"></span><span class="h-live-label">×¤×¢×™×œ</span>`
      : `<span style="font-size:0.58rem;color:var(--text-dim)">×”×•×¡×¨</span>`;
    const thumb = p.image
      ? `<img class="h-thumb" src="${p.image}" alt="" onerror="this.style.display='none'" />`
      : `<div class="h-thumb-placeholder">ğŸ–¼ï¸</div>`;

    return `
      <div class="history-row ${isLive ? '' : 'h-unpublished'}" data-id="${p.id}" style="animation-delay:${Math.min(i * 0.03, 0.3)}s">
        ${thumb}
        <div class="h-content">
          <div class="h-meta">
            <span class="h-source">${p.source || ''}</span>
            ${catBadge}
          </div>
          <div class="h-title">${p.title}</div>
          <div class="h-date">
            ${liveIndicator}
            ${dateStr ? `<span>Â·</span><span>${dateStr}</span>` : ''}
            <span>Â·</span>
            <div class="h-stars">${stars}</div>
          </div>
        </div>
        <div class="h-actions">
          ${p.link ? `<a class="icon-btn" href="${p.link}" target="_blank" rel="noopener" title="×¤×ª×— ×§×™×©×•×¨">â†—</a>` : ''}
          <button class="icon-btn unpublish" onclick="toggleLive('${p.id}')" title="${isLive ? '×”×¡×¨ ××”××ª×¨' : '×”×—×–×¨ ×œ××ª×¨'}">
            ${isLive ? 'âŠ˜' : 'â†º'}
          </button>
          <button class="icon-btn del" data-del-id="${p.id}" title="××—×§ ××”×”×™×¡×˜×•×¨×™×”">âœ•</button>
        </div>
      </div>`;
  }).join('');

  // Safe delete event delegation
  container.querySelectorAll('.icon-btn.del[data-del-id]').forEach(btn => {
    btn.addEventListener('click', () => deleteFromHistory(btn.dataset.delId));
  });
}

// â”€â”€ TOGGLE LIVE â”€â”€
function toggleLive(id) {
  let pub = JSON.parse(localStorage.getItem('pb_published') || '[]');
  const isLive = pub.some(p => p.id === id);
  if (isLive) {
    pub = pub.filter(p => p.id !== id);
    showToast('âŠ˜ ×”×•×¡×¨ ××”××ª×¨', 'success');
  } else {
    const item = history.find(p => p.id === id);
    if (item) pub.push(item);
    showToast('â†º ×”×•×—×–×¨ ×œ××ª×¨', 'success');
  }
  localStorage.setItem('pb_published', JSON.stringify(pub));
  renderStats();
  renderHistory();
}

// â”€â”€ DELETE FROM HISTORY â”€â”€
function deleteFromHistory(id) {
  // Also remove from active published
  let pub = JSON.parse(localStorage.getItem('pb_published') || '[]');
  pub = pub.filter(p => p.id !== id);
  localStorage.setItem('pb_published', JSON.stringify(pub));

  history = history.filter(p => p.id !== id);
  localStorage.setItem('pb_history', JSON.stringify(history));

  // Animate row out
  const row = document.querySelector(`.history-row[data-id="${id}"]`);
  if (row) {
    row.style.transition = 'opacity 0.2s, transform 0.2s';
    row.style.opacity = '0';
    row.style.transform = 'translateX(20px)';
    setTimeout(() => { renderStats(); renderHistory(); }, 220);
  } else {
    renderStats();
    renderHistory();
  }
  showToast('× ××—×§ ××”×”×™×¡×˜×•×¨×™×”', 'success');
}

// â”€â”€ CLEAR ALL HISTORY â”€â”€
function clearHistory() {
  if (!history.length) return showToast('×”×”×™×¡×˜×•×¨×™×” ×›×‘×¨ ×¨×™×§×”', 'error');
  const confirmed = confirm(`×”×× ×œ××—×•×§ ××ª ×›×œ ${history.length} ×”×›×•×ª×¨×•×ª ××”×”×™×¡×˜×•×¨×™×” ×œ×¦××™×ª×•×ª?\n×”××ª×¨ ×”×¦×™×‘×•×¨×™ ×’× ×™×ª×¨×•×§×Ÿ.`);
  if (!confirmed) return;
  history = [];
  localStorage.setItem('pb_history', '[]');
  localStorage.setItem('pb_published', '[]');
  renderStats();
  renderHistory();
  showToast('ğŸ—‘ ×”×”×™×¡×˜×•×¨×™×” × ××—×§×”', 'success');
}

// â”€â”€ TOAST â”€â”€
function showToast(msg, type = '') {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = `toast ${type} show`;
  setTimeout(() => t.classList.remove('show'), 2800);
}
</script>
</body>
</html>
